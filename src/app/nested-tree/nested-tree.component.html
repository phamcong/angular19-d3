<mat-form-field *ngIf="withFilter" appearance="fill" class="filter-input">
  <mat-label>Filter</mat-label>
  <input
    matInput
    (keyup)="filterChanged($event)"
    placeholder="Type to filter..."
  />
  <button
    *ngIf="filterValue"
    matSuffix
    mat-icon-button
    aria-label="Clear"
    (click)="clearFilter()"
  >
    <mat-icon>close</mat-icon>
  </button>
</mat-form-field>

<div class="breadcrumbs-container" *ngIf="withBreadcrumbs && checklistSelection.selected.length > 0">
  <app-breadcrumbs
    [selectedNodes]="checklistSelection.selected"
    [treeData]="dataSource"
  ></app-breadcrumbs>
</div>

<div class="tree-container" [style.maxHeight]="maxHeight">
  <mat-tree
    #tree
    [dataSource]="dataSource"
    [childrenAccessor]="childrenAccessor"
  >
    <!-- Leaf nodes -->
    <mat-tree-node
      *matTreeNodeDef="let node"
      matTreeNodePadding
      (click)="!multiple && selectNode(node)"
      [class.not-selectable]="node.selectable === false"
    >
      <mat-checkbox
        *ngIf="multiple"
        [checked]="checklistSelection.isSelected(node)"
        [disabled]="node.selectable === false"
        (change)="leafItemSelectionToggle(node)"
      >
      </mat-checkbox>
      <button mat-icon-button disabled></button>
      <span
        [class.selected]="!multiple && checklistSelection.isSelected(node)"
        >{{ node.name }}</span
      >
    </mat-tree-node>

    <!-- Expandable nodes -->
    <mat-tree-node
      *matTreeNodeDef="let node; when: hasChild"
      matTreeNodePadding
      matTreeNodeToggle
      [class.not-selectable]="node.selectable === false"
    >
      <button
        mat-icon-button
        matTreeNodeToggle
        [attr.aria-label]="'Toggle ' + node.name"
      >
        <mat-icon class="mat-icon-rtl-mirror">
          {{ tree.isExpanded(node) ? "expand_more" : "chevron_right" }}
        </mat-icon>
      </button>
      <mat-checkbox
        *ngIf="multiple"
        [checked]="
          independentParentChildSelection
            ? checklistSelection.isSelected(node)
            : descendantsAllSelected(node)
        "
        [indeterminate]="
          !independentParentChildSelection && descendantsPartiallySelected(node)
        "
        [disabled]="node.selectable === false"
        (change)="parentItemSelectionToggle(node)"
        (click)="$event.stopPropagation()"
      >
      </mat-checkbox>
      {{ node.name }}
    </mat-tree-node>
  </mat-tree>
</div>
